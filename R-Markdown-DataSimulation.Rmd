---
title: 'STSM3734 Assignment 1: Group 8 Simulation'
author: "Mlibo Majola"
date: "`r Sys.Date()`"
output:
  word_document: default
  html_document: default
---

# Part I: Observational Data Simulation

This script generates the "messy" observational dataset for the UFS Student Expenditure model.

```{r setup-data}
# Set seed for reproducibility
set.seed(2026)

# Number of observations
n <- 1000

# MODIFICATION: Moved living_arrangement BEFORE funding_source to fix 'object not found' logical error.
# X2: Living Arrangement (Categorical: 1=On campus, 2=Off campus(Res/Apartment), 3=Private)
living_arrangement <- sample(c(1, 2, 3), n, replace = TRUE, prob = c(0.3, 0.4, 0.3))

# X1: Funding Source (Binary: 1=NSFAS/Bursary, 0=Private; Treatment)
# Replaced rbinom with a conditional sample() function
funding_source <- ifelse(living_arrangement == 3, 
                         sample(c(1, 0), n, replace = TRUE, prob = c(0.2, 0.8)), 
                         sample(c(1, 0), n, replace = TRUE, prob = c(0.7, 0.3)))

# X3: Distance from Campus (Continuous - Correlated with Living Arrangement)
distance_km <- ifelse(living_arrangement == 1, abs(rnorm(n, 0.1, 0.05)),
                ifelse(living_arrangement == 2, abs(rnorm(n, 5, 2)),
                       abs(rnorm(n, 12, 4))))

# X4: Social Outings (Count variable)
# Replaced rpois with a simple rounded rnorm() calculation, using abs() to prevent negatives
social_outings <- round(abs(rnorm(n, mean = 4, sd = 2)))

# X5: Library Visits (Nuisance Variable)
# Replaced rpois with a rounded rnorm calculation
base_library_visits <- round(abs(rnorm(n, mean = 15, sd = 4)))
library_visits <- round(pmax(base_library_visits - (0.20 * social_outings), 0))

# Interaction Term - Funding * Outings (Used in True Model, but not a standalone column)
interaction_term <- funding_source * social_outings

# 6. The "True Model" for Expenditure (Y)
# X5 (Library Visits) is intentionally EXCLUDED from this equation so its true beta is 0.
living_effect <- ifelse(living_arrangement == 1, 0, 
                  ifelse(living_arrangement == 2, 300, 1500))

error <- rnorm(n, mean = 0, sd = 500)

monthly_expenditure_Y <- 1700 + (1200 * funding_source) + (400 * social_outings) + 
                         (200 * interaction_term) + living_effect + error

# Create the Data Frame
student_data <- data.frame(
  funding_source = funding_source,
  living_arrangement = as.factor(living_arrangement),
  distance_km = round(distance_km, 2),
  social_outings = social_outings,
  library_visits = library_visits,
  monthly_expenditure_Y = round(monthly_expenditure_Y, 2)
)

mdel <- lm(monthly_expenditure_Y ~ funding_source * social_outings + living_arrangement, data = student_data)

dir.create("outputs", showWarnings = FALSE)

# Save to CSV
write.csv(student_data, "outputs/UFS_Student_Expenditure_Data.csv", row.names = FALSE)

# Generate Scatterplot Matrix
# MODIFICATION: Corrected directory typo from "output" to "outputs"
png("outputs/Scatterplot_Matrix.png", width = 800, height = 800)
pairs(student_data[, c("distance_km", "social_outings", "library_visits", "monthly_expenditure_Y")], 
      pch = 16,            
      col = "black",      
      cex = 0.8,           
      labels = c("Distance (km)", "Social Outings", "Library Visits", "Expenditure (ZAR)"),
      main = "Student Expenditure Correlations")
dev.off()

summary(mdel)

# X1: Funding Source Graph
png("outputs/X1_Funding_Source.png")
barplot(table(student_data$funding_source), main = "Distribution of Funding Source", xlab = "0 = Private, 1 = NSFAS/Bursary", ylab = "Frequency", col = "lightblue")
dev.off()

# X2: Living Arrangement Graph
png("outputs/X2_Living_Arrangement.png")
barplot(table(student_data$living_arrangement), main = "Distribution of Living Arrangement", xlab = "1 = Res, 2 = Off-campus, 3 = Private", ylab = "Frequency", col = "lightgreen")
dev.off()

# X3: Distance Graph
png("outputs/X3_Distance.png")
hist(student_data$distance_km, main = "Distribution of Distance from Campus", xlab = "Distance (km)", col = "lightcoral", breaks = 20)
dev.off()

# X4: Social Outings Graph
png("outputs/X4_Social_Outings.png")
hist(student_data$social_outings, main = "Distribution of Social Outings", xlab = "Outings per Month", col = "plum", breaks = 15)
dev.off()

# X5: Library Visits Graph
png("outputs/X5_Library_Visits.png")
hist(student_data$library_visits, main = "Distribution of Library Visits", xlab = "Visits per Month", col = "wheat", breaks = 15)
dev.off()